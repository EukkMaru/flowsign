# UNSW-NB15 Packet-Level Detection Rules for Snort3
# These detect individual packets/signatures (complementing SnortSharp's flow analysis)

# ================================================================
# Reconnaissance / Analysis Attacks
# ================================================================

# Port scanning detection - multiple SYN packets
alert tcp any any -> any any (
    msg:"[SNORT3] Port Scan - Multiple SYN packets";
    flags:S;
    threshold: type threshold, track by_src, count 10, seconds 5;
    sid:1000001;
    rev:1;
)

# ICMP ping sweep
alert icmp any any -> any any (
    msg:"[SNORT3] ICMP Ping Sweep Detected";
    itype:8;
    threshold: type threshold, track by_src, count 20, seconds 10;
    sid:1000002;
    rev:1;
)

# TCP NULL scan
alert tcp any any -> any any (
    msg:"[SNORT3] TCP NULL Scan Detected";
    flags:0;
    sid:1000003;
    rev:1;
)

# TCP XMAS scan
alert tcp any any -> any any (
    msg:"[SNORT3] TCP XMAS Scan Detected";
    flags:FPU;
    sid:1000004;
    rev:1;
)

# ================================================================
# DoS / DDoS Attacks
# ================================================================

# SYN flood detection - excessive SYN without ACK
alert tcp any any -> any any (
    msg:"[SNORT3] SYN Flood Attack";
    flags:S,12;
    threshold: type threshold, track by_dst, count 100, seconds 5;
    sid:1000010;
    rev:1;
)

# UDP flood
alert udp any any -> any any (
    msg:"[SNORT3] UDP Flood Attack";
    threshold: type threshold, track by_dst, count 200, seconds 5;
    sid:1000011;
    rev:1;
)

# ICMP flood
alert icmp any any -> any any (
    msg:"[SNORT3] ICMP Flood Attack";
    threshold: type threshold, track by_dst, count 100, seconds 5;
    sid:1000012;
    rev:1;
)

# TCP RST flood
alert tcp any any -> any any (
    msg:"[SNORT3] TCP RST Flood";
    flags:R;
    threshold: type threshold, track by_dst, count 50, seconds 5;
    sid:1000013;
    rev:1;
)

# ================================================================
# Exploits / Shellcode
# ================================================================

# Large packet size (potential buffer overflow)
alert tcp any any -> any any (
    msg:"[SNORT3] Suspicious Large Packet - Possible Exploit";
    dsize:>1400;
    sid:1000020;
    rev:1;
)

# Potential shellcode pattern (NOP sled)
alert tcp any any -> any any (
    msg:"[SNORT3] Possible Shellcode - NOP Sled Detected";
    content:"|90 90 90 90 90 90 90 90|";
    sid:1000021;
    rev:1;
)

# Common exploit patterns
alert tcp any any -> any any (
    msg:"[SNORT3] Potential Buffer Overflow Exploit";
    content:"|AAAAAAAA|";
    pcre:"/A{100,}/";
    sid:1000022;
    rev:1;
)

# ================================================================
# Backdoor / Command & Control
# ================================================================

# Suspicious repeated connection attempts
alert tcp any any -> any any (
    msg:"[SNORT3] Backdoor - Repeated Connection Attempts";
    flags:S;
    threshold: type threshold, track by_src, count 30, seconds 60;
    sid:1000030;
    rev:1;
)

# Known backdoor ports
alert tcp any any -> any [31337,12345,54321,6666,6667,6668,6669] (
    msg:"[SNORT3] Connection to Known Backdoor Port";
    sid:1000031;
    rev:1;
)

# ================================================================
# Fuzzers
# ================================================================

# Malformed TCP packet
alert tcp any any -> any any (
    msg:"[SNORT3] Fuzzer - Malformed TCP Flags";
    flags:SF;
    sid:1000040;
    rev:1;
)

# Invalid TCP sequence
alert tcp any any -> any any (
    msg:"[SNORT3] Fuzzer - Invalid TCP State";
    flags:FSRPAU;
    sid:1000041;
    rev:1;
)

# ================================================================
# Worms
# ================================================================

# Rapid propagation pattern
alert tcp any any -> any any (
    msg:"[SNORT3] Worm Propagation - Rapid Scanning";
    flags:S;
    threshold: type threshold, track by_src, count 50, seconds 10;
    sid:1000050;
    rev:1;
)

# Common worm ports
alert tcp any any -> any [135,139,445,1433,3389] (
    msg:"[SNORT3] Worm Activity - Vulnerable Service Port";
    flags:S;
    threshold: type threshold, track by_src, count 20, seconds 10;
    sid:1000051;
    rev:1;
)

# ================================================================
# Generic Suspicious Activity
# ================================================================

# Excessive FIN packets
alert tcp any any -> any any (
    msg:"[SNORT3] Excessive FIN Packets";
    flags:F;
    threshold: type threshold, track by_src, count 30, seconds 10;
    sid:1000060;
    rev:1;
)

# Excessive PSH packets (possible data exfiltration)
alert tcp any any -> any any (
    msg:"[SNORT3] Excessive PSH Flags - Possible Data Exfiltration";
    flags:P;
    threshold: type threshold, track by_src, count 100, seconds 10;
    sid:1000061;
    rev:1;
)

# Very small packets with data (covert channel)
alert tcp any any -> any any (
    msg:"[SNORT3] Covert Channel - Suspicious Small Packets";
    dsize:1;
    threshold: type threshold, track by_src, count 50, seconds 10;
    sid:1000062;
    rev:1;
)
